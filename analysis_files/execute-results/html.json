{
  "hash": "ca2a3d9b8c27f01195428423ce6d12bb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Analysis\ndescription: Here we provide a detailed analysis using more sophisticated statistics techniques.\ntoc: true\ndraft: false\nruntime: shiny\n---\n\n\n![](https://upload.wikimedia.org/wikipedia/commons/7/77/Pebbleswithquarzite.jpg)\nLoading our Police Interaction dataset and all libraries.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsuppressPackageStartupMessages(library(tidymodels))\nsuppressPackageStartupMessages(library(reshape2)) #For models\nsuppressPackageStartupMessages(library(ggplot2)) #For plots\nsuppressPackageStartupMessages(library(shiny))\nsuppressPackageStartupMessages(library(shinylive)) #For interactive plots\nsuppressPackageStartupMessages(library(readr)) # For reading .rds files\nsuppressPackageStartupMessages(library(dplyr))\nsuppressPackageStartupMessages(library(tidyverse)) #For data wrangling, manipulation, etc.\nsuppressPackageStartupMessages(library(viridis)) #For visual themes\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'viridis' was built under R version 4.4.2\n```\n\n\n:::\n\n```{.r .cell-code}\nsuppressPackageStartupMessages(library(sf)) \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'sf' was built under R version 4.4.2\n```\n\n\n:::\n\n```{.r .cell-code}\nsuppressPackageStartupMessages(library(maps)) #For maps\nsuppressPackageStartupMessages(library(DT))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'DT' was built under R version 4.4.2\n```\n\n\n:::\n\n```{.r .cell-code}\ndata <- read_rds(here::here(\"dataset/police_interaction.rds\"))\n```\n:::\n\n\nThe first step of our EDA involves examining the \"PROPER\" variable, a binary variable which displays whether or not the police behaved properly during each interaction. This binary variable is reported for 19,321 of the 105,273 total cases, with 1,853 reported cases of the police behaving improperly and 17,468 cases of the police reporting properly. Here, we see how the proportion of improper police actions differs among different race populations. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata |>\n  filter(!is.na(PROPER)) |>\n  group_by(RACE) |>\n  summarize(\n    improper_proportion = sum(PROPER == 0) / n()\n  ) |>\n  ggplot(aes(x = RACE, y = improper_proportion, fill = RACE)) +\n  geom_bar(stat = \"identity\") + \n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](analysis_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\nThe plot shows that the black population experienced a much higher proportion of improper police interactions, with about 15% of reported interactions classified as improper. Among Hispianic and Other or multifacial, Non-Hispanic populations, the proportion of improper police interacts was about 10%, while the rate of improper police interactions among members of the White, Non-Hispanic population was about 7%.\n\nThis second plot is a heatmap that visualizes the correlations between various continuous variables in the dataset, where the color intensity represents the strength and direction of the correlation (with red indicating positive correlations and blue indicating negative correlations). There are notable positive correlations such as HHPOV and WORK_LW and notable negative correlations such as WORK_LW and any high-income indicator.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Categorizing variables based on their types\n#removed \"CONTACT\" and \"ERROR\" due to \"Warning in cor(numeric_data, use = \"complete.obs\") : the standard deviation is zero\" error\nbinary_columns <- c(\"MALE\", \"WORK_LW\", \"HHPOV\", \"PUB_HOUSE\",   \"PUB_HOUSE_SUB\", \"REGION\", \"INPERSON\", \"VICAR_CITIZEN\", \"VICAR_PRO_AUTO\", \"VICAR_PRO_PERS\", \"VICAR_OTH_CONT\", \"VICAR_IMPROPER\", \"D_HH_P23\", \"PROPER\")\n\nordinal_columns <- c(\"C4_RACE\", \"MAR_STAT\", \"FREQ_DRV\", \"TENURE\",  \"MSA_STATUS\")\n\ncontinuous_columns <- c(\"AGE\", \"EDUCATION\", \"EDUCATION_SUB\", \"NUM_MOVES\", \"NUM_CONT\", \"HH_SIZE\", \"PPCS_YEAR\", \"N_HH_P1\", \"N_PERS_P1\", \"NUM_CITIZEN_HH\", \"NUM_PRO_AUTO_HH\", \"NUM_PRO_PERS_HH\", \"NUM_OTH_CONT_HH\", \"NUM_IMPROPER_HH\")\n\nfiltered <- data\n# Selecting data by type\nbinary_data <- filtered %>%\n  select(all_of(binary_columns)) %>%\n  select(where(is.numeric))\n\nordinal_data <- filtered %>%\n  select(all_of(ordinal_columns)) %>%\n  select(where(is.numeric))\n\ncontinuous_data <- filtered %>%\n  select(all_of(continuous_columns)) %>%\n  select(where(is.numeric))\n\n# Calculating correlation matrices with appropriate methods\ncor_binary <- cor(binary_data, use = \"pairwise.complete.obs\", method = \"pearson\")\ncor_ordinal <- cor(ordinal_data, use = \"pairwise.complete.obs\", method = \"spearman\")\ncor_continuous <- cor(continuous_data, use = \"pairwise.complete.obs\", method = \"pearson\")\n\n# Creating a heatmap function\nplot_heatmap <- function(cor_matrix, title) {\n  cor_melted <- melt(cor_matrix)\n  ggplot(cor_melted, aes(Var1, Var2, fill = value)) +\n    geom_tile(color = \"white\") +\n    scale_fill_gradient2(low = \"blue\", high = \"red\", mid = \"white\",\n                         midpoint = 0, limit = c(-1, 1), name = \"Correlation\") +\n    labs(title = title, x = \"Variables\", y = \"Variables\") +\n    theme_minimal() +\n    theme(axis.text.x = element_text(angle = 90, hjust = 1),\n          axis.text.y = element_text(angle = 0, vjust = 1))\n}\n\n# Plotting heatmaps for each correlation matrix\nif (ncol(continuous_data) > 1) {\n  print(plot_heatmap(cor_continuous, \"Correlation Heatmap of Continuous Variables\"))\n}\n```\n\n::: {.cell-output-display}\n![](analysis_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nFor modeling, we used a linear model with an 80% split train and test set to try to predict whether someone would be arrested based on their race, years of education, if their household is living in poverty, and their gender. \nIn the training set, the F-statistic is far over 1 and the p-values show over 95% confidence in all the response variables being significant.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsplit <- initial_split(filtered, prop = .8) #good way to keep yourself honest. splits it by prop % being in training, 1-prop being test\ntraining<- training(split)\ntesting <- testing(split)\npredict_filtered <- training |>\n  filter(!is.na(ARRESTED) & !is.na(RACE) & !is.na(EDUCATION) & !is.na(HHPOV) & !is.na(MALE))\n\nmod1 <- lm(ARRESTED ~ RACE + EDUCATION + HHPOV + MALE, predict_filtered)\n```\n:::\n\n\nIn the test set, the F-statistic is much lower and the p-values and t-stats rise for each variable, with the p-value for each race variable but the intercept being over 0.1. This finding implies that there isn't a significant relationship on average between these race categories and being arrested, although, for \"Other or multiracial, Non-Hispanic\", that could be skewed by the much smaller sample size of the category compared to the other races in the category.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npredict_filtered_test <- testing |>\n  filter(!is.na(ARRESTED) & !is.na(RACE) & !is.na(EDUCATION) & !is.na(HHPOV) & !is.na(MALE))\n\nmod2 <- lm(ARRESTED ~ RACE + EDUCATION + HHPOV + MALE, predict_filtered_test)\nplot(mod2)\n```\n\n::: {.cell-output-display}\n![](analysis_files/figure-html/Testing Summary--1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](analysis_files/figure-html/Testing Summary--2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](analysis_files/figure-html/Testing Summary--3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](analysis_files/figure-html/Testing Summary--4.png){width=672}\n:::\n:::\n\n\nWe added another dataset that describes the number of homicides, the number of suicides, and the number of suicides done with firearms for whites & nonwhites within different states from 1949 to 2020.\n\nDataset:[Firearm Suicide Proxy for Household Gun Ownership](https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/QVYDUD)\n\nLoading our Firearm dataset.\n\n::: {.cell}\n\n```{.r .cell-code}\nfirearm_data <- read_rds(\"dataset/firearm_sh_ds.rds\")\n```\n:::\n\n\nThis map represents the rate of homicides by firearm by state. There are different levels of colors to represent the homicide rate by state, and the diagrams are split into 2002, 2008, and 2011.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfirearm_data <- firearm_data |>\n  mutate(firearm_homicide_rate = as.numeric(firearm_homicide_rate),\n         state = tolower(state)) |>\n  filter(!is.na(firearm_homicide_rate))\n\nus_states <- st_as_sf(maps::map(\"state\", plot = FALSE, fill = TRUE)) %>%\n  mutate(region = tolower(ID)) %>% # Convert state names to lowercase\n  select(region, geom) # Retain only state name and geometry columns\n\n\nmap_data <- us_states |>\n  rename(state = region) |>\n  left_join(firearm_data, by = \"state\")\n\nmap_data$log_firearm_homicide_rate <- log(map_data$firearm_homicide_rate + 1)\n \nggplot(map_data) +\n  geom_sf(aes(fill = log_firearm_homicide_rate), color = \"black\", size = 0.2) +\n  scale_fill_viridis_c(option = \"plasma\", name = \"Homicide Rate\") +\n  theme_minimal() +\n  labs(\n    title = \"Firearm Homicide Rate by State\",\n    fill = \"Rate\"\n  ) +\n  facet_wrap(~year)\n```\n\n::: {.cell-output-display}\n![](analysis_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\nThis chart normalizes racial proportions by multiplying by 100 to plot alongside homicide rates on the same scale, then multiplies firearm homicide rate by 10 to get a better understanding of what the trend looks like. From the plots, we can tell that the south and west regions have quite different firearm homicide rate * 10.\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- read_rds(here::here(\"dataset\", \"combined_regional_data.rds\"))\nggplot(data, aes(x = year)) +\n  geom_line(aes(y = fa_homicide_rate * 10, color = \"Firearm Homicide Rate * 10\"), size = 1) +\n  geom_line(aes(y = WHITE_NH_PROP * 100, color = \"White NH Prop\"), linetype = \"dashed\", size = 0.8) +\n  geom_line(aes(y = B_NH_PROP * 100, color = \"Black NH Prop\"), linetype = \"dashed\", size = 0.8) +\n  facet_wrap(~ region) +\n  labs(\n    title = \"Trends in Firearm Homicide Rate and Racial Proportions Over Time\",\n    x = \"Year\",\n    y = \"Rate (%)\",\n    color = \"Variable\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nâ„¹ Please use `linewidth` instead.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](analysis_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nThis interactive scatter plot shows the Firearm Homicide Rate relative to racial proportions of the 4 regions. Most of the firearm homicides took place in the South, with similar firearm homicide rate in the Midwest and Northeast, and the lowest rate of firearm homicides in the West. Looking at the different scatter plots, we observed that regions with more minorities had higher firearm homicide rate, which could be related to the higher proportion of improper police behavior reported by minorities than by non-minorities.\n\n```{shinylive-r}\n# Define server logic ----\nserver <- function(input, output) {\n  # Load the data\n  data <- read_rds(here::here(\"dataset\", \"combined_regional_data.rds\"))\n\n    # Render the interactive plot\n  output$scatterPlot <- renderPlot({\n    ggplot(data, aes(x = fa_homicide_rate, y = .data[[input$selected_race]])) +\n      geom_point(aes(color = as.factor(year)), size = 2, alpha = 0.7) + # Use color to differentiate years\n      geom_text(aes(label = year), vjust = -1, size = 3, alpha = 0.8) + # Add year annotations above points\n      facet_wrap(~ region) + # Optional: Facet by region\n      labs(\n        title = paste(\"Firearm Homicide Rate vs\", input$selected_race),\n        x = \"Firearm Homicide Rate\",\n        y = \"Proportion\",\n        color = \"Year\"\n      ) +\n      theme_minimal() +\n      theme(\n        legend.position = \"bottom\",       # Place legend at the bottom\n        legend.box = \"horizontal\",        # Align legend items horizontally\n        legend.text = element_text(size = 10), # Adjust legend text size\n        legend.title = element_text(size = 12), # Adjust legend title size\n        legend.key.width = unit(1, \"cm\"), # Add space between legend items\n        legend.spacing.x = unit(0.5, \"cm\") # Increase horizontal spacing\n      ) +\n      guides(\n        color = guide_legend(nrow = 1, byrow = TRUE) # Force a single-row legend\n      )\n  })\n}\n\n# Define UI for the application ----\nui <- fluidPage(\n  # Application title\n  titlePanel(\"Interactive Scatter Plot: Firearm Homicide Rate and Racial Proportions\"),\n  \n  # Sidebar layout with input and output\n  sidebarLayout(\n    # Sidebar panel for inputs\n    sidebarPanel(\n      # Dropdown menu for selecting racial group\n      selectInput(\n        inputId = \"selected_race\",\n        label = \"Select a Racial Group:\",\n        choices = c(\n          \"White NH\" = \"WHITE_NH_PROP\",\n          \"Black NH\" = \"B_NH_PROP\",\n          \"Hispanic\" = \"HISPANIC_PROP\",\n          \"Other/Multi NH\" = \"OTHER_MULTI_NH_PROP\"\n        ),\n        selected = \"WHITE_NH_PROP\"\n      )\n    ),\n    \n    # Main panel for displaying outputs\n    mainPanel(\n      plotOutput(outputId = \"scatterPlot\")\n    )\n  )\n)\n\n# Run the application ----\nshinyApp(ui = ui, server = server)\n```\n\n",
    "supporting": [
      "analysis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}