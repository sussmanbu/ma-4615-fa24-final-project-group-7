{
  "hash": "5c7db5ca33f107c97c26d7c58fd3343f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"more EDA\"\ndescription:  |\n  More EDA and Initial thoughts\nauthor: \"\"\ndate: \"2024-11-06\"\ndate-modified: \"2024-11-06\"\ndraft: FALSE\n---\n\nThis week, we continued exploring the dataset with a focus on relationships among different variables such as reasons for traffic stops, arrests, and the types of police contacts experienced under different demographical groups.\n\nFor example, below is a plot being generated. We studied the disparities in experiences of improper police contact among different racial groups. We made a bar plot to illustrate the proportion within each racial group who reported experiencing improper police contact and the result reveals notable differences across racial groups.This insight lays the groundwork for deeper analysis to understand what factors contribute to these differences, potentially using demographic and situational variables in further modeling.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsuppressPackageStartupMessages(library(tidyverse))\nsuppressPackageStartupMessages(library(tidymodels))\ndata <- readRDS(\"dataset/police_interaction.rds\") \ndata |>\n  filter(!is.na(PROPER)) |>\n  group_by(RACE) |>\n  summarize(\n    improper_proportion = sum(PROPER == 0) / n()\n  ) |>\n  ggplot(aes(x = RACE, y = improper_proportion, fill = RACE)) +\n  geom_bar(stat = \"identity\")\n```\n\n::: {.cell-output-display}\n![](more-eda_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n\nThis is the second plot that we would like to include here: \nWe made a heatmap that visualizes the correlations between various binary variables in the dataset, where the color intensity represents the strength and direction of the correlation (with red indicating positive correlations and blue indicating negative correlations). There are notable positive correlations such as HHPOV and WORK_LW and notable negative correlations such as WORK_LW and any high-income indicator.\nThis heatmap helps identify groups of binary variables that may be related or unrelated, which can be useful in modeling and to understand relationships among the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(reshape2)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'reshape2'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:tidyr':\n\n    smiths\n```\n\n\n:::\n\n```{.r .cell-code}\n# Categorizing variables based on their types\n#removed \"CONTACT\" and \"ERROR\" due to \"Warning in cor(numeric_data, use = \"complete.obs\") : the standard deviation is zero\" error\nbinary_columns <- c(\"MALE\", \"WORK_LW\", \"HHPOV\", \"PUB_HOUSE\",   \"PUB_HOUSE_SUB\", \"REGION\", \"INPERSON\", \"VICAR_CITIZEN\", \"VICAR_PRO_AUTO\", \"VICAR_PRO_PERS\", \"VICAR_OTH_CONT\", \"VICAR_IMPROPER\", \"D_HH_P23\", \"PROPER\")\n\nordinal_columns <- c(\"C4_RACE\", \"MAR_STAT\", \"FREQ_DRV\", \"TENURE\",  \"MSA_STATUS\")\n\ncontinuous_columns <- c(\"AGE\", \"EDUCATION\", \"EDUCATION_SUB\", \"NUM_MOVES\", \"NUM_CONT\", \"HH_SIZE\", \"PPCS_YEAR\", \"N_HH_P1\", \"N_PERS_P1\", \"NUM_CITIZEN_HH\", \"NUM_PRO_AUTO_HH\", \"NUM_PRO_PERS_HH\", \"NUM_OTH_CONT_HH\", \"NUM_IMPROPER_HH\")\n\nfiltered <- data\n# Selecting data by type\nbinary_data <- filtered %>%\n  select(all_of(binary_columns)) %>%\n  select(where(is.numeric))\n\nordinal_data <- filtered %>%\n  select(all_of(ordinal_columns)) %>%\n  select(where(is.numeric))\n\ncontinuous_data <- filtered %>%\n  select(all_of(continuous_columns)) %>%\n  select(where(is.numeric))\n\n# Calculating correlation matrices with appropriate methods\ncor_binary <- cor(binary_data, use = \"pairwise.complete.obs\", method = \"pearson\")\ncor_ordinal <- cor(ordinal_data, use = \"pairwise.complete.obs\", method = \"spearman\")\ncor_continuous <- cor(continuous_data, use = \"pairwise.complete.obs\", method = \"pearson\")\n\n# Creating a heatmap function\nplot_heatmap <- function(cor_matrix, title) {\n  cor_melted <- melt(cor_matrix)\n  ggplot(cor_melted, aes(Var1, Var2, fill = value)) +\n    geom_tile(color = \"white\") +\n    scale_fill_gradient2(low = \"blue\", high = \"red\", mid = \"white\",\n                         midpoint = 0, limit = c(-1, 1), name = \"Correlation\") +\n    labs(title = title, x = \"Variables\", y = \"Variables\") +\n    theme_minimal() +\n    theme(axis.text.x = element_text(angle = 90, hjust = 1),\n          axis.text.y = element_text(angle = 0, vjust = 1))\n}\n\n# Plotting heatmaps for each correlation matrix\nif (ncol(binary_data) > 1) {\n  print(plot_heatmap(cor_binary, \"Correlation Heatmap of Binary Variables\"))\n}\n```\n\n::: {.cell-output-display}\n![](more-eda_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\nif (ncol(ordinal_data) > 1) {\n  print(plot_heatmap(cor_ordinal, \"Correlation Heatmap of Ordinal Variables\"))\n}\n```\n\n::: {.cell-output-display}\n![](more-eda_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n\n```{.r .cell-code}\nif (ncol(continuous_data) > 1) {\n  print(plot_heatmap(cor_continuous, \"Correlation Heatmap of Continuous Variables\"))\n}\n```\n\n::: {.cell-output-display}\n![](more-eda_files/figure-html/unnamed-chunk-2-3.png){width=672}\n:::\n:::\n\n\nFor modeling, we used a linear model to try to predict whether someone would be arrested based on their race, years of education, if their household is living in poverty, and their gender. We separated the data into a train and test set with an 80% split. \nIn the training set, the F-statistic is far over 1 and the p-values show over 95% confidence in all the response variables being significant.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsplit <- initial_split(filtered, prop = .8) #good way to keep yourself honest. splits it by prop % being in training, 1-prop being test\ntraining<- training(split)\ntesting <- testing(split)\npredict_filtered <- training |>\n  filter(!is.na(ARRESTED) & !is.na(RACE) & !is.na(EDUCATION) & !is.na(HHPOV) & !is.na(MALE))\n\nmod1 <- lm(ARRESTED ~ RACE + EDUCATION + HHPOV + MALE, predict_filtered)\nsummary(mod1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = ARRESTED ~ RACE + EDUCATION + HHPOV + MALE, data = predict_filtered)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.14455 -0.04151 -0.02427 -0.00624  1.00259 \n\nCoefficients:\n                                         Estimate Std. Error t value Pr(>|t|)\n(Intercept)                             0.0904159  0.0091551   9.876  < 2e-16\nRACEHispanic                           -0.0240934  0.0064852  -3.715 0.000204\nRACEOther or multiracial, Non-Hispanic -0.0326553  0.0084717  -3.855 0.000116\nRACEWhite, Non-Hispanic                -0.0238257  0.0050149  -4.751 2.05e-06\nEDUCATION                              -0.0043107  0.0005633  -7.652 2.12e-14\nHHPOV                                   0.0266464  0.0045917   5.803 6.66e-09\nMALE                                    0.0274877  0.0027780   9.895  < 2e-16\n                                          \n(Intercept)                            ***\nRACEHispanic                           ***\nRACEOther or multiracial, Non-Hispanic ***\nRACEWhite, Non-Hispanic                ***\nEDUCATION                              ***\nHHPOV                                  ***\nMALE                                   ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1553 on 12599 degrees of freedom\nMultiple R-squared:  0.01945,\tAdjusted R-squared:  0.01899 \nF-statistic: 41.66 on 6 and 12599 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(mod1)\n```\n\n::: {.cell-output-display}\n![](more-eda_files/figure-html/Training Summary--1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](more-eda_files/figure-html/Training Summary--2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](more-eda_files/figure-html/Training Summary--3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](more-eda_files/figure-html/Training Summary--4.png){width=672}\n:::\n:::\n\n\nIn the test set, the F-statistic is much lower and the p-values and t-stats rise for each variable, with the p-value for each race variable but the intercept being over 0.1. This finding implies that there isn't a significant relationship on average between these race categories and being arrested, although, for \"Other or multiracial, Non-Hispanic\", that could be skewed by the much smaller sample size of the category compared to the other races in the category.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npredict_filtered_test <- testing |>\n  filter(!is.na(ARRESTED) & !is.na(RACE) & !is.na(EDUCATION) & !is.na(HHPOV) & !is.na(MALE))\n\nmod2 <- lm(ARRESTED ~ RACE + EDUCATION + HHPOV + MALE, predict_filtered_test)\nsummary(mod2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = ARRESTED ~ RACE + EDUCATION + HHPOV + MALE, data = predict_filtered_test)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.13150 -0.03915 -0.02264 -0.01141  1.01105 \n\nCoefficients:\n                                        Estimate Std. Error t value Pr(>|t|)\n(Intercept)                             0.120609   0.018320   6.583 5.38e-11\nRACEHispanic                           -0.030231   0.013192  -2.292  0.02200\nRACEOther or multiracial, Non-Hispanic -0.010195   0.016738  -0.609  0.54253\nRACEWhite, Non-Hispanic                -0.030584   0.009953  -3.073  0.00214\nEDUCATION                              -0.005615   0.001130  -4.968 7.12e-07\nHHPOV                                   0.011710   0.009176   1.276  0.20204\nMALE                                    0.016503   0.005649   2.921  0.00351\n                                          \n(Intercept)                            ***\nRACEHispanic                           *  \nRACEOther or multiracial, Non-Hispanic    \nRACEWhite, Non-Hispanic                ** \nEDUCATION                              ***\nHHPOV                                     \nMALE                                   ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1565 on 3089 degrees of freedom\nMultiple R-squared:  0.01675,\tAdjusted R-squared:  0.01484 \nF-statistic: 8.771 on 6 and 3089 DF,  p-value: 1.687e-09\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(mod2)\n```\n\n::: {.cell-output-display}\n![](more-eda_files/figure-html/Testing Summary--1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](more-eda_files/figure-html/Testing Summary--2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](more-eda_files/figure-html/Testing Summary--3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](more-eda_files/figure-html/Testing Summary--4.png){width=672}\n:::\n:::\n",
    "supporting": [
      "more-eda_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}