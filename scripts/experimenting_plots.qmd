```{r}
suppressPackageStartupMessages(library(tidyverse))

```



```{r}
filtered <- read_rds("dataset/police_interaction.rds")

```


```{r}
create_barplot <- function(data, col_name) {
  ggplot(data, aes_string(x = col_name)) +
    geom_bar(fill = "skyblue", color = "black") +
    labs(title = paste("Barplot of", col_name),
         x = col_name,
         y = "Count") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}
reason_key = c("Out of universe/missing", "Accident", "Traffic stop-driver", "Traffic stop-passenger", "Rsp reported crime", "Police assistance", "Police investigation", "Police suspected rsp", "Other reason")
filtered |>
  group_by(RACE) |>
  mutate(
    reason_text = reason_key[REASON + 1] 
  ) |>
  ggplot(aes(x = REASON, fill = reason_text)) +
    geom_bar(show.legend = TRUE) +
    theme_minimal() +
  facet_wrap(~RACE) 
  #theme(legend.title = element_text(hjust = 1))

```


```{r}
ggplot(filtered, aes(x = as.factor(ARRESTED), fill = as.factor(RACE))) +
  geom_bar(position = "fill") +
  labs(title = "Proportion of Arrests by Race", x = "Arrested (0 = No, 1 = Yes)", y = "Proportion", fill = "Race")



```


```{r}

ggplot(filtered, aes(x = as.factor(CONTACT), fill = as.factor(RACE))) +
  geom_bar(position = "fill") +
  labs(title = "Proportion of Race by Police Contact", x = "Police Contact", y = "Proportion", fill = "Race") +
  scale_x_discrete(labels = c("0" = "No", "1" = "Yes")) +
  scale_y_continuous(labels = scales::percent)
```


```{r}

ggplot(filtered, aes(x = as.factor(C_CONTCT), fill = as.factor(RACE))) +
  geom_bar(position = "fill") +
  labs(title = "Proportion of Contact Type by Race", x = "Contact Type", y = "Proportion", fill = "Race") +
  scale_x_discrete(labels = c("0" = "No contact", 
                              "1" = "Citizen-initiated contact", 
                              "2" = "Vehicle stop", 
                              "3" = "Suspect-related contact", 
                              "4" = "Other police contact")) +
  scale_y_continuous(labels = scales::percent)



```